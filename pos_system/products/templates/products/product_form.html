{% extends "dashboard_base.html" %}

{% block title %}Product Form{% endblock title %}

{% block extra_css %}
.container {
max-width: 1000px;
margin: 20px auto;
margin-bottom: 50px;
padding: 0 15px;
}

.page-header {
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 20px;
}

.page-header h2 {
color: #024f83;
margin: 0;
font-size: 2rem;
}

.back-btn {
background: #0ea5e9;
color: #fff;
padding: 6px 12px;
border-radius: 5px;
text-decoration: none;
font-size: 14px;
}

.product-form-card {
background: #fff;
padding: 20px;
border-radius: 8px;
box-shadow: 0 2px 6px rgba(0,0,0,0.1);
margin-bottom: 20px;
}

.form-row {
display: flex;
gap: 15px;
margin-bottom: 15px;
}

.form-row input,
.form-row select {
flex: 1;
padding: 10px;
border: 1px solid #ccc;
border-radius: 6px;
}

.add-btn {
background: #0284c7;
border: none;
color: #fff;
padding: 10px 15px;
border-radius: 6px;
cursor: pointer;
transition: background 0.3s;
}

.add-btn:hover {
background: #0369a1;
}
.back-btn-container {
text-align: left;
margin-bottom: 20px;
}
.back-btn {
background: #0284c7;
border: none;
color: #fff;
padding: 6px 15px;
border-radius: 6px;
cursor: pointer;
font-size: 15px;
text-decoration: none;
transition: background 0.3s;
margin-bottom: 20px;
}
.back-btn:hover {
background: #0369a1;
}


/* --- Responsive --- */
@media (max-width: 768px) {
.form-row {
flex-direction: column;
}
.add-btn {
width: 100%;
}
.back-btn {
font-size: 13px;
}
}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h2>Products</h2>
    </div>

    <div class="back-btn-container">
        <a href="{% url 'products:products_list_view' %}" class="back-btn"><< Back</a>
    </div>

    {% if messages %}
    <div class="messages" style="margin-bottom: 20px; border: 1px solid #ccc;">
        {% for message in messages %}
        {% if message.tags == "error" %}
        <div class="message" style="padding: 10px; color: red;">{{ message }}</div>
        {% else %}
        <div class="message" style="padding: 10px; color: green;">{{ message }}</div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <div class="product-form-card">
        <form method="post" novalidate>
            {% csrf_token %}

            <!-- Product Name & Barcode -->
            <div class="form-row">
                {{ form.product_name }}
                {{ form.barcode }}
            </div>
            {% if form.barcode.errors %}
            <div class="form-row" style="color: red; font-size: 0.9rem;">
                {% for error in form.barcode.errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Purchase & Sale Price -->
            <div class="form-row">
                {{ form.purchase_price }}
                {{ form.sale_price }}
            </div>
            {% if form.purchase_price.errors %}
            <div class="form-row" style="color: red; font-size: 0.9rem;">
                {% for error in form.purchase_price.errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}
            {% if form.sale_price.errors %}
            <div class="form-row" style="color: red; font-size: 0.9rem;">
                {% for error in form.sale_price.errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Quantity & Low Stock -->
            <div class="form-row">
                {{ form.quantity }}
                {{ form.low_stock }}
            </div>
            {% if form.quantity.errors %}
            <div class="form-row" style="color: red; font-size: 0.9rem;">
                {% for error in form.quantity.errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}
            {% if form.low_stock.errors %}
            <div class="form-row" style="color: red; font-size: 0.9rem;">
                {% for error in form.low_stock.errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Category & Submit -->
            <div class="form-row">
                {{ form.category }}
                {{ form.vendor }}
            </div>
            {% if form.vendor.errors %}
            <div class="form-row" style="color: red; font-size: 0.9rem;">
                {{ form.vendor.errors.1 }}
            </div>
            {% endif %}            

            <button type="submit" class="add-btn">
                    {% if form.instance and form.instance.pk %}Update Product{% else %}+ Add Product{% endif %}
            </button>
        </form>
    </div>

</div>
{% endblock %}


{% block extra_js %}

{% comment %} document.addEventListener('DOMContentLoaded', () => {
    const barcodeInput = document.getElementById('id_barcode'); // Django gives id="id_<fieldname>"
    barcodeInput.focus();

    // Optional: auto-submit when Enter is sent by scanner
    barcodeInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('productForm').submit();
        }
    });

    // Optional: always re-focus for next scan
    barcodeInput.addEventListener('blur', () => {
        setTimeout(() => barcodeInput.focus(), 200);
    });
}); {% endcomment %}

{% endblock extra_js %}